name: Community

on:
  pull_request_target:
    types: [opened, synchronize, reopened]
  issues:
    types: [opened]
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  # ============================================
  # Label - Auto-label PRs based on files
  # ============================================
  label:
    name: Label PR
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target'
    steps:
      - uses: actions/labeler@v5
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: .github/labeler.yml
          sync-labels: true

  # ============================================
  # Welcome - Greet first-time contributors
  # ============================================
  welcome:
    name: Welcome
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target' || github.event_name == 'issues'
    steps:
      - uses: actions/first-interaction@v3
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          issue-message: |
            Thanks for opening your first issue! ðŸŽ‰

            We appreciate you taking the time to report this. A maintainer will review it soon.

            In the meantime:
            - Make sure you've provided all the requested information
            - Check if there's a similar existing issue
            - Feel free to ask questions if anything is unclear

            Welcome to the Revue community! ðŸš€
          pr-message: |
            Thanks for your first pull request! ðŸŽ‰

            We're excited to have you contribute to Revue. A maintainer will review your PR soon.

            While you wait:
            - Make sure all CI checks pass
            - Review the [Contributing Guide](https://github.com/hawk90/revue/blob/main/CONTRIBUTING.md) if you haven't already
            - Feel free to ask questions in the PR comments

            Welcome to the Revue community! ðŸš€

  # ============================================
  # Stale - Mark inactive issues/PRs
  # ============================================
  stale:
    name: Mark Stale
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    steps:
      - uses: actions/stale@v10
        with:
          stale-issue-message: >
            This issue has been automatically marked as stale because it has not had
            recent activity. It will be closed in 14 days if no further activity occurs.
            Thank you for your contributions!
          stale-pr-message: >
            This pull request has been automatically marked as stale because it has not had
            recent activity. It will be closed in 14 days if no further activity occurs.
            Thank you for your contributions!
          close-issue-message: >
            This issue was closed because it has been stale for 14 days with no activity.
            Feel free to reopen if you still need help!
          close-pr-message: >
            This pull request was closed because it has been stale for 14 days with no activity.
            Feel free to reopen if you want to continue working on it!
          days-before-stale: 60
          days-before-close: 14
          stale-issue-label: "stale"
          stale-pr-label: "stale"
          exempt-issue-labels: "pinned,security,help wanted,good first issue"
          exempt-pr-labels: "pinned,security,work in progress"
          operations-per-run: 100
